#!/usr/bin/env python3.9

from random import shuffle

poem = open("poem.txt").read()

assert all(ord(c)<127 for c in poem)

def str_to_markov(s):
    freqs = {}
    ret = {}
    for i, c in enumerate(s[:-2]):
        key = s[i:i+2]
        if key not in ret:
            ret[key] = []
        ret[key].append(s[i+2])
    keys = list(ret.keys())
    shuffle(keys)
    for key in keys:
        freqs[key] = [(c,ret[key].count(c)/len(ret[key])) for c in set(ret[key])]
        shuffle(freqs[key])
    return freqs

freq_dict = str_to_markov(poem)
print(f"{freq_dict = }")
print(f"{len(poem) = }")

'''
d = {'b': [('a', 0.5), ('y', 0.5)], 'i': [('c', 0.3333333333333333), ('n', 0.3333333333333333), ('l', 0.3333333333333333)], 'l': [('l', 0.25), ('a', 0.25), ('_', 0.25), ('d', 0.25)], 'd': [('_', 0.3333333333333333), ('i', 0.3333333333333333), ('e', 0.3333333333333333)], '{': [('t', 1.0)], 'g': [('_', 0.5), ('a', 0.5)], 'w': [('i', 1.0)], 's': [('c', 1.0)], 'a': [('l', 0.2), ('d', 0.4), ('d', 0.4), ('o', 0.2), ('r', 0.2)], 'c': [('t', 0.5), ('a', 0.5)], 'f': [('{', 0.5), ('_', 0.5)], 'h': [('e', 1.0)], 'y': [('_', 1.0)], 'e': [('_', 0.3333333333333333), ('a', 0.3333333333333333), ('}', 0.3333333333333333)], 'r': [('e', 0.5), ('_', 0.5)], 'n': [('g', 1.0)], 'o': [('f', 0.3333333333333333), ('l', 0.3333333333333333), ('s', 0.3333333333333333)], '_': [('b', 0.2857142857142857), ('o', 0.2857142857142857), ('r', 0.14285714285714285), ('g', 0.14285714285714285), ('b', 0.2857142857142857), ('o', 0.2857142857142857), ('w', 0.14285714285714285)], 't': [('f', 0.5), ('h', 0.5)]}
len(FLAG) = 47
'''